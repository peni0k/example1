name: Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, "3.10", "3.11"]

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest

    - name: Run tests
      run: |
        python -m pytest test_analysis.py -v

    - name: Run basic import tests
      run: |
        python -c "import pandas as pd; import streamlit as st; import numpy as np; print('Dependencies imported successfully')"
        
    - name: Run basic application test
      run: |
        python -c "
        import pandas as pd
        from datetime import date
        from analysis import calculate_sales_kpis, get_filtered_data
        
        # Create a simple test
        data = {
            'date': pd.to_datetime(['2023-01-01', '2023-01-02']),
            'category': ['Electronics', 'Clothing'],
            'price': [100.0, 50.0],
            'quantity': [2, 1]
        }
        df = pd.DataFrame(data)
        
        # Test the functions
        result = calculate_sales_kpis(df)
        print('calculate_sales_kpis works:', result)
        
        filtered = get_filtered_data(df, date(2023, 1, 1), date(2023, 1, 2))
        print('get_filtered_data works:', len(filtered))
        
        print('Basic functionality test passed!')
        "